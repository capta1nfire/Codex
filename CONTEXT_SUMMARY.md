# üìã **CODEX - Documento de Transferencia para Agentes IA**

**√öltima Actualizaci√≥n**: 14 de Junio, 2025  
**Versi√≥n del Proyecto**: 1.3.0  
**Estado**: ‚úÖ **DESARROLLO ACTIVO - FASE 2.0** | üöÄ **API v1/v2 REESTRUCTURADA** | üõ°Ô∏è **SISTEMA ESTABILIZADO CON PM2**

---

## üö™ **ORDEN DE LECTURA PARA AGENTES IA** (EMPEZAR AQU√ç)

> **üéØ ESTE ES TU PRIMER DOCUMENTO** - Si eres un nuevo agente IA, est√°s en el lugar correcto.

### **üìö Secuencia de Lectura Obligatoria:**
1. **üî• PRIMERO**: `CONTEXT_SUMMARY.md` ‚Üê **EST√ÅS AQU√ç** (orientaci√≥n t√©cnica inmediata)
2. **üß≠ SEGUNDO**: `.nav.md` ‚Üê **NAVEGACI√ìN R√ÅPIDA** (üö® **CR√çTICO** - Evita perder tiempo buscando archivos. Tu GPS del proyecto)
3. **üëë TERCERO**: `CODEX.md` (roadmap estrat√©gico y fases de desarrollo) 
4. **üìñ CUARTO**: `README.md` (setup t√©cnico detallado)
5. **üõ†Ô∏è QUINTO**: `CLAUDE.md` ‚Üê **GU√çA PR√ÅCTICA IA** (comandos y workflows para desarrollo)
6. **üìö SEXTO**: `docs/README.md` ‚Üê **√çNDICE MAESTRO DE DOCUMENTACI√ìN** (mapa completo de docs)
7. **üé® S√âPTIMO**: `docs/CODEX_DESIGN_SYSTEM.md` ‚Üê **LECTURA OBLIGATORIA** (filosof√≠a visual y patrones UI)
8. **üöÄ OCTAVO**: `docs/technical/barcode-research.md` ‚Üê **INVESTIGACI√ìN ESTRAT√âGICA** (an√°lisis t√©cnico de c√≥digos)
9. **üîß ESPEC√çFICO**: Consultar `docs/` para documentaci√≥n organizada por tema

### **üìÇ Estructura de Documentaci√≥n (IMPORTANTE)**
- **üß≠ `.nav.md`** - **[HERRAMIENTA ESENCIAL]** Navegaci√≥n r√°pida del proyecto - Encuentra archivos en segundos, no minutos
- **`CLAUDE.md`** - Gu√≠a pr√°ctica para agentes IA (comandos, workflows, tips)
- **`docs/README.md`** - Hub central con √≠ndice completo y navegaci√≥n
- **`docs/qr-engine/`** - QR Engine v2 (technical guide, changelog, status)
- **`docs/implementation/`** - Auditor√≠as e implementaciones mayores
- **`docs/api/`** - Documentaci√≥n API completa
- **`docs/database/`** - Esquema y optimizaciones BD
- **`docs/technical/`** - Especificaciones t√©cnicas y research
- **`docs/archive/`** - Documentos hist√≥ricos (solo referencia)

**‚ö†Ô∏è REGLAS CR√çTICAS**:
1. **SIEMPRE** verificar en `docs/` antes de crear nueva documentaci√≥n
2. **NUNCA** crear documentos duplicados - actualizar existentes
3. **CONSULTAR** `docs/DOCUMENTATION_AUDIT_20250608.md` para entender la consolidaci√≥n

> **‚è∞ Tiempo estimado**: 25 minutos para entender completamente el proyecto (incluyendo navegaci√≥n r√°pida, design system e investigaci√≥n estrat√©gica)

---

## üö® **REGLAS DE JUEGO CR√çTICAS** (LEER PRIMERO)

> **‚ö†Ô∏è ATENCI√ìN AGENTE IA**: Este documento es tu **br√∫jula absoluta**. L√©elo completamente antes de hacer cualquier acci√≥n.

### **üî¥ PROHIBICIONES ABSOLUTAS**
- ‚ùå **NUNCA archivar, mover o eliminar** `CODEX.md` (documento maestro)
- ‚ùå **NUNCA crear documentaci√≥n fragmentada** sin consultar primero
- ‚ùå **NUNCA duplicar informaci√≥n** que ya existe en documentaci√≥n establecida
- ‚ùå **NUNCA reestructurar** jerarqu√≠a de archivos sin aprobaci√≥n expl√≠cita
- ‚ùå **NUNCA ignorar** las fases del roadmap definidas en `CODEX.md`
- ‚ùå **NUNCA cambiar puertos** sin actualizar CODEX.md primero (fuente √∫nica)
- ‚ùå **NUNCA crear elementos visuales** sin consultar `docs/CODEX_DESIGN_SYSTEM.md`

### **‚úÖ ACCIONES AUTORIZADAS**
- ‚úÖ **Actualizar documentaci√≥n existente** con nueva informaci√≥n
- ‚úÖ **Corregir bugs** y errores t√©cnicos
- ‚úÖ **Mejorar c√≥digo** siguiendo patrones establecidos
- ‚úÖ **Agregar tests** para validar funcionalidad
- ‚úÖ **Optimizar performance** sin cambiar arquitectura core
- ‚úÖ **Usar puertos definidos** en CODEX.md (3000, 3004, 3002)
- ‚úÖ **Aplicar design system v2.0** siguiendo tokens y patrones establecidos

### **ü§î REQUIERE CONSULTA PREVIA**
- üîÑ Crear nuevos archivos de documentaci√≥n
- üîÑ Cambiar estructura de carpetas o archivos cr√≠ticos
- üîÑ Modificar arquitectura o tecnolog√≠as core
- üîÑ Agregar nuevas dependencias importantes
- üîÑ Cambiar procesos de desarrollo establecidos
- üîÑ **Cambiar configuraci√≥n de puertos** (requiere actualizar m√∫ltiples archivos)
- üîÑ **Crear nuevos componentes UI** sin seguir patrones del design system

---

## üìÅ **JERARQU√çA DE DOCUMENTACI√ìN** (SAGRADA)

### **üî¥ CR√çTICOS - NUNCA TOCAR SIN PERMISO**
```
‚îú‚îÄ‚îÄ CODEX.md                     # üëë DOCUMENTO MAESTRO - Roadmap/Estrategia
‚îú‚îÄ‚îÄ README.md                    # Overview t√©cnico principal
‚îú‚îÄ‚îÄ CLAUDE.md                    # ü§ñ Gu√≠a para AI agents (actualizada)
‚îî‚îÄ‚îÄ CHANGELOG.md                 # Referencias a documentaci√≥n organizada
```

### **üü° IMPORTANTES - CONSULTAR ANTES DE MODIFICAR**
```
‚îú‚îÄ‚îÄ CONTEXT_SUMMARY.md           # üìã ESTE DOCUMENTO (transferencia IA)
‚îú‚îÄ‚îÄ docs/CODEX_DESIGN_SYSTEM.md  # üé® DESIGN SYSTEM v2.0 "Corporate Sophistication" (LECTURA OBLIGATORIA)
‚îú‚îÄ‚îÄ docs/technical/stability-improvements.md  # üõ°Ô∏è Soluci√≥n PM2 para estabilidad
‚îî‚îÄ‚îÄ validate_implementation.js   # Script de validaci√≥n cr√≠tico
```

### **üü¢ T√âCNICOS - MODIFICABLES CON CUIDADO**
```
‚îú‚îÄ‚îÄ docs/                        # üìö TODA LA DOCUMENTACI√ìN ORGANIZADA
‚îÇ   ‚îú‚îÄ‚îÄ qr-engine/              # QR Engine v2 completo
‚îÇ   ‚îú‚îÄ‚îÄ implementation/         # Implementaciones y auditor√≠as
‚îÇ   ‚îú‚îÄ‚îÄ api/                    # Documentaci√≥n API
‚îÇ   ‚îú‚îÄ‚îÄ database/               # Documentaci√≥n BD
‚îÇ   ‚îî‚îÄ‚îÄ technical/              # Especificaciones t√©cnicas
‚îú‚îÄ‚îÄ backend/README.md            # Documentaci√≥n espec√≠fica backend
‚îú‚îÄ‚îÄ frontend/README.md           # Documentaci√≥n espec√≠fica frontend
‚îî‚îÄ‚îÄ rust_generator/README.md     # Documentaci√≥n espec√≠fica Rust
```

### **‚ö™ ARCHIVADOS - NO TOCAR**
```
‚îî‚îÄ‚îÄ docs/archive/                # Documentos obsoletos o hist√≥ricos
```

---

## üéØ **ESTADO ACTUAL DEL PROYECTO**

### **üìä Fase Actual: 1.5 ‚Üí 2.0** (seg√∫n CODEX.md l√≠nea 158)
- ‚úÖ **Fase 1 (MVP)**: Completada - Interfaz b√°sica
- ‚úÖ **Fase 1.5 (Pre-Beta)**: 90% completada
- üîÑ **Fase 2 (Beta)**: En progreso activo

### **üèóÔ∏è Arquitectura Establecida**
```
Frontend (Next.js 14 + TypeScript)
    ‚ÜïÔ∏è HTTP/REST
Backend (Node.js + Express + Prisma)
    ‚ÜïÔ∏è Direct Calls
Rust Generator (Axum + rxing)
    ‚ÜïÔ∏è SQL
PostgreSQL Database + Redis Cache
```

### **üöÄ Implementaciones Cr√≠ticas Completadas**
- ‚úÖ **Build System**: TypeScript completamente estable
- ‚úÖ **Testing**: Vitest configurado, 8/8 tests passing
- ‚úÖ **Linting**: ESLint estabilizado en v8.57.0
- ‚úÖ **Error Handling**: Error boundaries con Sentry
- ‚úÖ **Clipboard**: useClipboard hook con fallback universal
- ‚úÖ **Dashboard**: Responsive con m√©tricas tiempo real
- ‚úÖ **QR Engine v2**: 100% activo en producci√≥n, performance 10x mejor (Jun 2025)
  - ‚ö†Ô∏è **IMPORTANTE**: Ver `docs/qr-engine/QR_ENGINE_V2_REFERENCE.md` para estado real
  - ‚ùå **Gradientes NO funcionan** - Procesador existe pero no integrado en SVG
- ‚úÖ **PM2 Process Manager**: Sistema robusto con auto-restart y monitoreo (Jun 2025)

### **üõ°Ô∏è Sistema de Gesti√≥n de Servicios PM2 (NUEVO)**
```bash
# M√âTODO RECOMENDADO - Estable con auto-restart
./pm2-start.sh    # Inicia todos los servicios con PM2

# Comandos PM2 √∫tiles:
pm2 status        # Estado de todos los servicios
pm2 logs          # Logs en tiempo real
pm2 restart all   # Reiniciar todos
pm2 stop all      # Detener todos
pm2 monit         # Monitor interactivo

# Detener servicios:
./stop-services.sh # Limpia todos los procesos
```

**Caracter√≠sticas PM2:**
- Auto-restart si falla un servicio
- L√≠mites de memoria configurados
- Backend sin modo watch para estabilidad
- Logs organizados por servicio

---

## üéØ **INVESTIGACI√ìN ESTRAT√âGICA**

**CR√çTICO**: Lee `docs/technical/barcode-research.md` para entender la estrategia de especializaci√≥n.

**Resumen**: CODEX se enfoca en dominar 5 c√≥digos clave (QR, Data Matrix, EAN/UPC, Code 128, ITF-14) que representan el 85% del mercado, en lugar de cubrir superficialmente 30-50 tipos como la competencia.

---

## üîß **STACK TECNOL√ìGICO ACTUAL**

### **‚úÖ DEPENDENCIAS ESTABILIZADAS**
```json
// Frontend - Versiones FIJAS (no cambiar)
{
  "next": "14.2.29",           // ‚ö†Ô∏è ESTABLE 
  "react": "18.3.1",          // ‚ö†Ô∏è ESTABLE
  "eslint": "8.57.0",         // ‚ö†Ô∏è DOWNGRADE NECESARIO
  "vitest": "3.1.4"           // ‚úÖ TESTING CONFIGURADO
}

// Backend - En desarrollo activo
{
  "express": "latest",         // üîÑ DESARROLLO
  "prisma": "latest",         // üîÑ ORM PRINCIPAL
  "typescript": "latest"      // üîÑ DESARROLLO
}
```

### **üèóÔ∏è COMANDOS DE DESARROLLO**
```bash
# ‚≠ê SHORTCUTS DISPONIBLES (ARREGLADOS EN ESTA SESI√ìN)
./dev.sh                     # Script completo con colores y monitoreo (FIXED v1.1.1)
./dev-start.sh              # Script simple para todos los servidores (FIXED v1.1.1)
npm run dev                 # Concurrently con kill-others (FIXED v1.1.1)

# Comandos por servicio (m√©todo tradicional)
cd frontend && npm run dev  # Puerto 3000
cd backend && npm run dev   # Puerto 3004  
cd rust_generator && cargo run  # Puerto 3002 (CORRECTED)
```

---

## üß† **CONTEXTO DE DECISIONES T√âCNICAS**

### **üîß Fixes Recientes Implementados**
1. **TypeScript Build**: Resueltos 20+ errores de compilaci√≥n
2. **ESLint**: Downgrade a v8.57.0 por compatibilidad Next.js
3. **Vitest**: Configuraci√≥n globals y exclusiones e2e
4. **Clipboard API**: Hook universal con fallback `useClipboard`
5. **Sentry**: APIs deprecadas corregidas
6. **CSS**: Propiedades est√°ndar `line-clamp` agregadas
7. **üî¥ PUERTOS**: Conflictos resueltos - fuente √∫nica en CODEX.md
8. **üöÄ SCRIPTS**: Scripts de desarrollo arreglados (v1.1.1)

### **üìã Logros T√©cnicos Recientes** 
> **Nota**: Ver historial completo en `CHANGELOG.md`

#### **Hoy (14 Junio 2025)**
- ‚úÖ **API v1/v2**: Reestructuraci√≥n completa con endpoints especializados
- ‚úÖ **`.nav.md`**: Actualizado con workflows modernos y validaci√≥n autom√°tica
- ‚úÖ **Documentaci√≥n**: Reorganizaci√≥n de CONTEXT_SUMMARY.md para claridad

#### **Implementaciones Clave Activas**
- ‚úÖ **PM2 Process Manager**: Sistema estable con auto-restart y monitoreo
- ‚úÖ **Super Admin System**: Sidebar exclusivo y control de acceso robusto
- ‚úÖ **Dashboard Enterprise**: 3 columnas, modo avanzado, health checks
- ‚úÖ **AI Workflow Tools**: `.workspace/`, scripts helpers, `.nav.md`
- ‚úÖ **Performance**: HTTP pooling, rate limits optimizados, cache mejorado

### **üéØ Pr√≥ximos Pasos Autorizados** (seg√∫n CODEX.md)
- [ ] Integraci√≥n activa de Redis Cache
- [ ] Validaci√≥n robusta de inputs con Zod
- [ ] Mejoras de performance (√≠ndices BD, alertas)
- [ ] M√°s simbolog√≠as + GS1 Digital Link
- [ ] Panel de anal√≠ticas b√°sicas

### **‚ö° OPTIMIZACI√ìN DE RENDIMIENTO (June 9, 2025)**
- ‚úÖ **AUDITOR√çA PROFUNDA**: Identificados cuellos de botella principales (72 req/s l√≠mite)
- ‚úÖ **HTTP CONNECTION POOLING**: Implementado con undici (100 conexiones persistentes)
- ‚úÖ **CONFIGURACIONES OPTIMIZADAS**: 
  - Timeouts: 5s ‚Üí 30s
  - Rate limit: 100 ‚Üí 10,000 requests
  - Thread pool: default ‚Üí 16
  - Cache TTL: 5min ‚Üí 10min
- ‚úÖ **INFRAESTRUCTURA DE TESTING**: Scripts de carga gradual con m√©tricas detalladas
- ‚ö†Ô∏è **BOTTLENECK IDENTIFICADO**: Arquitectura single-instance limita escalabilidad
- üìù **DOCUMENTACI√ìN COMPLETA**: `/docs/technical/performance-optimization-session-20250609.md`
- üéØ **TARGET PENDIENTE**: 300-500 req/s requiere escalamiento horizontal

### **ü§ñ METODOLOG√çA DE TRABAJO OPTIMIZADA PARA IA (June 10, 2025)**
- ‚úÖ **WORKSPACE STRUCTURE**: Creada estructura `.workspace/` para trabajo eficiente
  - `temp/`: Archivos temporales (auto-limpiados)
  - `session-logs/`: Logs estructurados de cada sesi√≥n
  - `templates/`: Plantillas para consistencia
- ‚úÖ **AI HELPER SCRIPTS**: Scripts especializados para agentes IA
  - `session-start.sh`: Inicializa sesi√≥n con contexto completo
  - `project-status.sh`: Estado comprensivo del proyecto
  - `recent-changes.sh`: An√°lisis de cambios recientes
  - `session-cleanup.sh`: Limpieza post-sesi√≥n
- ‚úÖ **QUICK NAVIGATION**: Archivo `.nav.md` con rutas r√°pidas a workflows comunes
- ‚úÖ **SCRIPT ORGANIZATION**: Reorganizaci√≥n tem√°tica
  - `scripts/ai-helpers/`: Herramientas para IA
  - `scripts/dev/`: Utilidades de desarrollo
  - `scripts/test/`: Scripts de testing
  - `scripts/ops/`: Scripts operacionales
- ‚úÖ **SESSION TRACKING**: Sistema de logs estructurados para cada sesi√≥n
- üìù **DOCUMENTACI√ìN**: Ver `.workspace/README.md` para detalles completos

### **üìä Dashboard - Partes Cr√≠ticas Implementadas**

#### **Layout de 3 Columnas con Altura Forzada**
```typescript
// frontend/src/app/dashboard/page.tsx - ESTRUCTURA CR√çTICA
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 items-stretch">
  <div className="h-full"><SystemStatus isAdvancedMode={isAdvancedMode} /></div>
  <div className="h-full"><CacheMetricsPanel isAdvancedMode={isAdvancedMode} /></div>
  <div className="h-full"><RustAnalyticsDisplay /></div>
</div>
```

#### **Sistema de Modo Avanzado**
- **Estado centralizado**: `isAdvancedMode` en dashboard principal
- **Props drilling controlado**: Solo a componentes que necesitan funcionalidad avanzada
- **Controla**: Botones configuraci√≥n, acciones destructivas, control servicios

#### **Cache Clearing Integration**
```typescript
// CacheMetricsPanel.tsx - ENDPOINT CR√çTICO
const handleClearCache = async () => {
  await fetch(`${rustUrl}/cache/clear`, { method: 'POST' });
  setTimeout(() => fetchCacheStats(), 1000); // Refresco autom√°tico
};
```

#### **Configuraci√≥n de Altura Forzada**
- **SystemStatus**: `w-full h-full` (removido max-w-4xl mx-auto)  
- **CacheMetricsPanel**: `h-full` en todos los estados (loading, normal, sin datos)
- **RustAnalyticsDisplay**: `h-full` en Card ra√≠z
- **Grid**: `items-stretch` garantiza altura igual entre columnas

#### **Variables de Entorno Cr√≠ticas**
```bash
NEXT_PUBLIC_BACKEND_URL=http://localhost:3004    # Health checks + control servicios
NEXT_PUBLIC_RUST_SERVICE_URL=http://localhost:3002  # Cache clearing + analytics
```

---


## üö® **PROBLEMAS CONOCIDOS Y SOLUCIONES**

### **üî¥ Errores Cr√≠ticos Resueltos**
1. **`navigator.clipboard undefined`** ‚Üí ‚úÖ Hook `useClipboard` con fallback
2. **`ESLint 9 incompatible`** ‚Üí ‚úÖ Downgrade a v8.57.0  
3. **`Vitest globals undefined`** ‚Üí ‚úÖ tsconfig.json types configurado
4. **`CODEX.md archivado`** ‚Üí ‚úÖ Restaurado a ra√≠z

### **üü° Limitaciones Actuales**
- Redis configurado pero no activamente integrado
- Frontend: warnings menores de ESLint (no cr√≠ticos)
- Testing: cobertura podr√≠a mejorar

---

## üìñ **REGLAS DE DOCUMENTACI√ìN**

### **‚úÖ CU√ÅNDO ACTUALIZAR DOCUMENTACI√ìN EXISTENTE**
- Agregar informaci√≥n a `TROUBLESHOOTING.md` para nuevos problemas
- Actualizar `CHANGELOG.md` con cambios significativos  
- Modificar `README.md` con nuevas instrucciones de setup
- Actualizar `API_DOCUMENTATION.md` con nuevos endpoints

### **‚ùå CU√ÅNDO NO CREAR DOCUMENTACI√ìN NUEVA**
- Fix puntual de bug (agregar a TROUBLESHOOTING.md)
- Mejora menor de performance (agregar a CHANGELOG.md)
- Configuraci√≥n espec√≠fica (agregar a README.md correspondiente)
- Cambio temporal o experimental

### **ü§î CU√ÅNDO PREGUNTAR ANTES DE DOCUMENTAR**
- Implementaci√≥n de nueva funcionalidad mayor
- Cambio de arquitectura o tecnolog√≠a
- Proceso nuevo que afecta m√∫ltiples desarrolladores
- Documentaci√≥n que podr√≠a volverse obsoleta r√°pidamente

---

## üîÑ **PROCESO DE TRANSFERENCIA IA**

**Inicio R√°pido**: Seguir el "ORDEN DE LECTURA" al inicio de este documento.

**Al Finalizar Sesi√≥n**: Ejecutar checklist de buenas pr√°cticas en `CLAUDE.md` (secci√≥n üßπ)

---

## ‚ö° **METODOLOG√çA FOCUS** (OBLIGATORIO - LEER CADA 30 MIN)

> **PROBLEMA**: Las IAs crean demasiada documentaci√≥n innecesaria.  
> **SOLUCI√ìN**: 80% c√≥digo, 20% documentaci√≥n. NO crear archivos nuevos.

### **Regla de Oro**: 
```
ANTES de crear CUALQUIER archivo (c√≥digo o documentaci√≥n):
0. ¬øTengo dudas? ‚Üí PREGUNTAR AL USUARIO PRIMERO
1. ¬øYa existe este archivo? ‚Üí PREGUNTAR "¬øExiste already X.tsx?"
2. ¬øPuedo actualizar uno existente? ‚Üí S√ç = Actualizar
3. ¬øEs cr√≠tico para el proyecto? ‚Üí NO = No crear
4. ¬øEl usuario lo pidi√≥ expl√≠citamente? ‚Üí NO = No crear
```

### **üö® REGLA CARDINAL: ANTE LA DUDA, PREGUNTA**
- "¬øYa existe un componente para X?"
- "¬øD√≥nde deber√≠a ir esta funcionalidad?"
- "¬øHay un archivo similar que pueda actualizar?"
- "He encontrado page.tsx, ¬ødebo modificarlo o crear uno nuevo?"

### **Archivos Permitidos para Actualizar**:
- `CHANGELOG.md` - Cambios del d√≠a (2-5 l√≠neas m√°x)
- `TROUBLESHOOTING.md` - Solo si hay un problema NUEVO
- `README.md` correspondiente - Solo cambios de setup
- Archivos en `docs/` EXISTENTES - NO crear nuevos

### **Check R√°pido** (cada 30 minutos):
- ¬øCu√°nto tiempo sin escribir c√≥digo? > 10 min = PROBLEMA
- ¬øCu√°ntos archivos nuevos creaste? > 0 = JUSTIFICAR
- ¬øActualizaste CHANGELOG.md? NO = Hacerlo ahora

**Ver `CLAUDE.md` secci√≥n "FOCUS Methodology" para detalles completos**

---

## üìû **RECURSOS R√ÅPIDOS**

**Comando Principal**: `./pm2-start.sh` (inicia todos los servicios con auto-restart)

**URLs**: Frontend (3000), Backend (3004), Rust (3002)

---

## üèÜ **M√âTRICAS DE √âXITO ACTUAL**

```
üìä ESTADO DEL PROYECTO:
‚úÖ Build Success Rate: 100%
‚úÖ Test Pass Rate: 8/8 (100%)
‚úÖ ESLint: Stable configuration
‚úÖ TypeScript: 0 compilation errors
‚úÖ Documentation: Well-organized hierarchy
‚úÖ Development: 3 server startup shortcuts
‚úÖ Error Handling: Universal clipboard support

üéØ PR√ìXIMOS OBJETIVOS:
üîÑ Complete Fase 2 (Beta) seg√∫n CODEX.md
üîÑ Integrate Redis cache actively  
üîÑ Implement robust input validation
üîÑ Add more barcode symbologies
üîÑ Build analytics dashboard
```

---

## üöÄ **ESTADO ACTUAL API v1/v2** (14 Junio 2025)

### **üìã Estructura de Endpoints Implementada**
```
‚úÖ /api/v1/barcode    ‚Üí C√≥digos de barras con motor Node.js (v1)
‚úÖ /api/v2/qr         ‚Üí QR codes con motor Rust (v2)
```

### **üîÑ Endpoints Legacy (Con Headers de Deprecaci√≥n)**
```
‚ö†Ô∏è /api/generate      ‚Üí Use /api/v1/barcode (remover: Junio 2025)
‚ö†Ô∏è /api/qr/*          ‚Üí Use /api/v2/qr/* (remover: Junio 2025)
```

### **üîß Problemas Resueltos Durante Reestructuraci√≥n**
1. ‚úÖ **Error "fetch is not defined"** - Importaci√≥n undici corregida
2. ‚úÖ **404/422 en endpoints v2** - Rutas y formato de request arreglados  
3. ‚úÖ **Variable no definida** - qrService.ts l√≠nea 88 corregida
4. ‚úÖ **Headers de deprecaci√≥n** - Removidos de endpoints v2 activos

### **üìö Documentaci√≥n Clave**
- **Gu√≠a de Migraci√≥n**: `/docs/api/v1-v2-migration-guide.md`
- **Desaf√≠os T√©cnicos**: `/docs/technical/endpoint-restructuring-challenges-20250614.md`
- **QR Engine v2**: `/docs/qr-engine/README.md`

### **üéØ Estado de Integraci√≥n**
```javascript
// Frontend hooks actualizados autom√°ticamente
useBarcodeGenerationV2() {
  // QR ‚Üí /api/v2/qr/generate
  // Otros ‚Üí /api/v1/barcode
}
```

---

## üéñÔ∏è **CONCLUSI√ìN**

**Siguiente paso**: Lee los documentos en el orden indicado al inicio.

**Recuerda**: PM2 para servicios, respetar jerarqu√≠a de docs, seguir Design System v2.0.

---

*√öltima actualizaci√≥n: 14 de Junio, 2025 - API v1/v2 reestructurada y documentaci√≥n de desaf√≠os t√©cnicos completada*

**üìö CAMBIO IMPORTANTE (Jun 8, 2025)**: Toda la documentaci√≥n ha sido consolidada y organizada en el directorio `/docs/`. Los documentos originales fueron archivados con timestamp. Siempre verificar en `/docs/` antes de crear nueva documentaci√≥n. 

## üåê **CONFIGURACI√ìN DE PUERTOS** (REFERENCIA R√ÅPIDA)

> **üìã FUENTE AUTORIZADA**: `CODEX.md` secci√≥n "PORT CONFIGURATION"

### **‚úÖ PUERTOS DEFINITIVOS**
```bash
Frontend:    3000  # Next.js - Interfaz principal
Backend:     3004  # Express - API y l√≥gica de negocio  
Rust:        3002  # Axum - Generaci√≥n de c√≥digos de alto rendimiento
PostgreSQL:  5432  # Base de datos
Redis:       6379  # Cache
```

### **üöÄ SCRIPTS DE DESARROLLO FUNCIONANDO**
```bash
# ‚≠ê RECOMENDADO: Script completo (FUNCIONA 100%)
./dev.sh

# üîß ALTERNATIVO: Script simple (FUNCIONA ~90%)  
./dev-start.sh

# üì¶ ALTERNATIVO: NPM (FUNCIONA ~70%)
npm run dev
```

**üéØ Estado de Scripts (Post-Fix v1.2.0):**
- `./dev.sh`: ‚úÖ Inicia 3/3 servidores + monitoreo + logs + **AUTO-CLEANUP** (ENHANCED)
- `./dev-start.sh`: ‚ö†Ô∏è Inicia 2-3/3 servidores (ocasionales fallos)
- `npm run dev`: ‚ö†Ô∏è Inicia 1-2/3 servidores (conflictos concurrently)

### **üöÄ NUEVA CARACTER√çSTICA v1.2.0**: Auto-cleanup de procesos duplicados
```bash
# ‚ú® AUTOM√ÅTICO: El script ahora limpia procesos anteriores antes de iniciar
./dev.sh  # Mata procesos en puertos 3000,3002,3004 + rust_generator + next/tsx duplicados
```

### **üèóÔ∏è ENTERPRISE SERVICE CONTROL v2.0** (IMPLEMENTADO HOY)

#### **üîß Backend Mejorado - Control Robusto de Servicios**
```typescript
// ‚úÖ NUEVO: Control de Database con health checks reales
- startDatabaseService(): Creaci√≥n autom√°tica v√≠a docker-compose
- stopDatabaseService(): Verificaci√≥n de parada exitosa  
- Validaci√≥n con pg_isready y timeouts configurables

// ‚úÖ NUEVO: Control de Rust Service con process management
- spawn() controlado con detached: false para mejor control
- Cleanup inteligente por puerto y nombre de proceso
- Health checks autom√°ticos post-inicio (http://localhost:3002/health)
- Manejo de procesos zombies y limpieza de puerto 3002

// ‚úÖ NUEVO: Backend restart REAL
- Development: process.exit(0) para tsx/nodemon restart
- Production: Detecci√≥n autom√°tica PM2/systemd con restart real
- Fallback manual con instrucciones claras
```

#### **üåê Nuevos Endpoints Enterprise**
```bash
GET  /api/services/status           # Estado de todos los servicios
GET  /api/services/{service}/status # Estado de servicio individual  
POST /api/services/health-check     # Health check forzado completo
POST /api/services/{service}/{action} # Acciones con detalles mejorados
```

#### **üì± Frontend Dashboard Mejorado**
```typescript
// ‚úÖ NUEVO: Estados visuales en tiempo real
- Botones con loading/success/error states
- Colores din√°micos (azul=loading, verde=success, rojo=error)
- Timeouts diferentes por tipo de servicio
- Bot√≥n "Check completo" para health check forzado
- Feedback espec√≠fico para restart de backend (3s timeout)
```

#### **üéØ Casos de Uso Solucionados**
1. **Rust service colgado**: Cleanup autom√°tico de puerto + process
2. **Backend restart**: Restart real en desarrollo y producci√≥n  
3. **Database no inicia**: Auto-creaci√≥n v√≠a docker-compose
4. **Procesos zombies**: Limpieza inteligente con SIGTERM ‚Üí SIGKILL
5. **Feedback user**: Estados visuales inmediatos en dashboard
6. **üõ°Ô∏è DATABASE PROTECTION**: Stop/restart bloqueados para estabilidad del sistema

#### **üõ°Ô∏è PROTECCI√ìN DE BASE DE DATOS** (CR√çTICO - NUEVA IMPLEMENTACI√ìN)

**PROBLEMA RESUELTO**: Al detener el backend tambi√©n se deten√≠a la base de datos, causando inestabilidad del sistema.

**CAMBIOS IMPLEMENTADOS**:
1. **Backend API Protection**:
   - ‚úÖ `POST /api/services/database/stop` ‚Üí Bloqueado con mensaje informativo
   - ‚úÖ `POST /api/services/database/restart` ‚Üí Bloqueado para evitar downtime 
   - ‚úÖ `POST /api/services/database/start` ‚Üí Permitido (solo inicia si est√° detenida)

2. **Frontend UI Protection**:
   - ‚úÖ Botones Stop/Restart de Database **ocultos** en `SystemStatus.tsx`
   - ‚úÖ Solo se muestra bot√≥n **Start** para Database
   - ‚úÖ Otros servicios (Backend/Rust) mantienen todos los botones

3. **Arquitectura Mantenida**:
   - ‚úÖ Database (Docker) independiente del Backend (Node.js)
   - ‚úÖ Base de datos persiste cuando backend se detiene/reinicia
   - ‚úÖ Integridad del sistema preservada

**ARCHIVOS MODIFICADOS**:
```
backend/src/index.ts              # API endpoints protegidos
frontend/src/components/SystemStatus.tsx # UI con botones filtrados
```

**FILOSOF√çA**: "La base de datos es infraestructura cr√≠tica que debe permanecer estable."

## üßπ **BUENAS PR√ÅCTICAS PARA AGENTES IA**

> **üìã NOTA**: El checklist completo de buenas pr√°cticas ha sido movido a `CLAUDE.md` (secci√≥n üßπ Best Practices Checklist) para mejor accesibilidad y mantenimiento.

## üö® **TROUBLESHOOTING**

Para soluciones detalladas a problemas comunes, ver: **`docs/TROUBLESHOOTING.md`**

### **Problemas Documentados:**
- ‚ùå **PostgreSQL m√∫ltiples instancias** - "User denied access"
- üõ°Ô∏è **Sistema de Observabilidad** - Dashboard robusto con health checks
- üîß **Validaci√≥n de entorno** - Scripts autom√°ticos en `./dev.sh`

## üî• **SISTEMA DE ROLES Y SEGURIDAD**

### **Super Admin System**
- **Arquitectura**: Sidebar exclusivo para SUPERADMIN con navegaci√≥n categorizada
- **Componentes clave**: `SuperAdminSidebar.tsx`, `SuperAdminLayout.tsx`, `RoleGuard.tsx`
- **Experiencia diferenciada**: Click directo al dashboard vs dropdown para otros roles
- **Seguridad reforzada**: Control estricto de acceso por roles

### **Jerarqu√≠a de Roles**
| **Rol** | **Acceso** | **Restricciones** |
|---------|------------|-------------------|
| SUPERADMIN | Control total del sistema | Ninguna |
| WEBADMIN | Gesti√≥n usuarios, monitoreo | No puede controlar servicios cr√≠ticos |
| PREMIUM/ADVANCED | Funciones avanzadas | No administraci√≥n |
| USER | Generador b√°sico | Solo funciones b√°sicas |

> **Nota**: Para detalles t√©cnicos de implementaci√≥n, ver documentaci√≥n en `frontend/src/components/admin/`

---

## üóÑÔ∏è **BASE DE DATOS**

### **Estado Actual**
- **PostgreSQL 15** en Docker √∫nicamente (puerto 5432)
- **Volumen correcto**: `codexproject_postgres_data`
- **4 usuarios** migrados con roles correctos

### **Usuarios del Sistema**
| Email | Rol | Prop√≥sito |
|-------|-----|-----------|
| `capta1nfire@me.com` | SUPERADMIN | Control total |
| `admin@codex.com` | WEBADMIN | Gesti√≥n t√©cnica |
| `premium@codex.com` | PREMIUM | Usuario premium test |
| `user@codex.com` | USER | Usuario b√°sico test |

> **‚ö†Ô∏è IMPORTANTE**: Si encuentras problemas de "datos perdidos" o m√∫ltiples PostgreSQL, ver **`docs/database/README.md`** para soluci√≥n completa del problema de vol√∫menes Docker.

---

## üé® **DESIGN SYSTEM v2.0**

### **"Corporate Sophistication"**
- **Filosof√≠a**: Interfaces profesionales con elegancia sutil
- **Paleta**: Corporate Blue como color de confianza universal
- **Componentes**: Glassmorphism selectivo, gradientes corporativos
- **Layout**: Hero-driven con progressive disclosure
- **M√©tricas**: -40% friction, +200% visual prominence

> **üìö LECTURA OBLIGATORIA**: Ver **`docs/CODEX_DESIGN_SYSTEM.md`** (993 l√≠neas) para implementaci√≥n completa

---

*√öltima actualizaci√≥n: 14 de Junio, 2025 - Documento condensado y reorganizado para claridad*